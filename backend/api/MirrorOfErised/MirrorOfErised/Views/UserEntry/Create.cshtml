@using MirrorOfErised.models
@model MirrorOfErised.ViewModels.UserEntryCreateViewModel
@{
    ViewData["Title"] = "Setup user profile";
}

<link rel="stylesheet" href="/css/dropzone.min.css" />
<link rel="stylesheet" href="/css/basic.min.css" />

<h1>Setup your user profile</h1>
<hr />

<div class="row">
    <div class="col-md">
        <p>Upload some images of yourself.</p>
        <small class="form-text text-muted">We need at least 3 pictures of you. Your uploaded picture should only contain your face and should not be grayscaled.</small>
        <form action="/UserEntry/Upload" method="post" id="my-awesome-dropzone"></form>
        <form enctype="multipart/form-data" asp-action="Create">
            <div>
                <span asp-validation-summary="All" class="text-danger"></span>
            </div>
            <div class="form-group d-none" id="js-commute-car">
                <fieldset>
                    <legend>Your address</legend>
                    <small id="addressHelp" class="form-text text-muted">
                        We use this to give you real-time updates of traffic when you're on your way home.
                        You can leave this empty.
                    </small>
                    <label asp-for="Address.Street" class="control-label"></label>
                    <input asp-for="Address.Street" class="form-control"/>
                    <span asp-validation-for="Address.Street" class="text-danger"></span>

                    <label asp-for="Address.City" class="control-label"></label>
                    <input asp-for="Address.City" class="form-control"/>
                    <span asp-validation-for="Address.City" class="text-danger"></span>
                </fieldset>
            </div>
            <div class="form-group d-none" id="js-commute-train">
                <fieldset>
                    <legend>Departing station</legend>
                    <small id="trainHelp" class="form-text text-muted">
                        We use this to give you real-time updates of the current train schedule.
                        You can leave this empty.
                    </small>
                    <label asp-for="Address.City" class="control-label"></label>
                    <input asp-for="Address.City" class="form-control"/>
                    <span asp-validation-for="Address.City" class="text-danger"></span>
                </fieldset>
            </div>
            <div class="form-group">
                <label asp-for="CommutingWay" class="control-label"></label>
                <select asp-for="CommutingWay" id="js-commuting" class="form-control"
                        asp-items="Html.GetEnumSelectList<CommutingOption>()">
                    <option>Select a commute type</option>
                </select>
                <span asp-validation-for="CommutingWay" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary"/>
            </div>

        </form>
    </div>
</div>

@section Scripts {
    <script src="/js/dropzone.min.js"></script>
    <script>
        $(document).ready(function () {
            function showFieldSet(id) {
                const options = ['train', 'car', 'other']
                const selectedOption = options[id];
                options.map(option => {
                    if (option === selectedOption)
                        $(`#js-commute-${option}`).removeClass('d-none');
                    else
                        $(`#js-commute-${option}`).addClass('d-none');

                })
            }
            $('#js-commuting').on('change', function(e) {
                showFieldSet(e.target.value);
            });
            
            //Dropzone
            const dropzone = new Dropzone('#my-awesome-dropzone', {
                url: '/UserEntry/Upload',
                paramName: 'image', 
                maxFilesize: 5,
                init: function () {
                    $('#my-awesome-dropzone').addClass('dropzone');
                    this.on('complete', function(file) {
                        console.log(file);
                        if (file.status === 'error' && file.xhr.status === 400) {
                            file.previewElement.style.border = '1px solid red';
                            file.previewElement.children[3].innerHTML = 'Invalid image.';
                        }
                    })
                }
            });
        });
    </script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
